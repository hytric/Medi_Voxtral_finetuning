# Dataset - SLLM 멀티태스크 데이터셋

SLLM(Speech-Language Large Model) 프로젝트를 위한 멀티태스크 데이터셋 컬렉션입니다. ASR(음성인식), SQA(음성 질의응답), TQA(텍스트 질의응답) 세 가지 태스크를 지원합니다.

## 📁 데이터셋 구조

```
dataset/
├── ASR.jsonl                    # 음성인식 학습 데이터 (141,820개)
├── SQA.jsonl                    # 음성 질의응답 학습 데이터 (16,403개)  
├── TQA.jsonl                    # 텍스트 질의응답 학습 데이터 (168,903개)
├── val_ASR.jsonl                # 음성인식 검증 데이터 (2,145개)
├── val_SQA.jsonl                # 음성 질의응답 검증 데이터 (1,823개)
├── val_TQA.jsonl                # 텍스트 질의응답 검증 데이터 (18,767개)
├── med_qa_dedup_normalize.py    # 의료 QA 데이터 정제 스크립트
└── datagen/                     # 데이터 생성 도구들
    ├── TTS/                     # 음성 합성 데이터 생성
    ├── 뉴스/                     # 뉴스 기반 QA 생성
    ├── 비대면 진료/               # 비대면 진료 데이터 처리
    ├── 아산/                     # 아산병원 의료 데이터 변환
    └── 초거대/                   # 초거대 AI 데이터셋 활용
```

## 📊 데이터셋 상세 구조

### 1. ASR (음성인식) 데이터

**파일:** `ASR.jsonl`, `val_ASR.jsonl`

**형식:**
```json
{
  "audio_path": "141.의료진_및_환자_음성/01.데이터/2.Validation/원천데이터/nur/HA_0266/HA_0266-1247-01-02-F-04-A.wav",
  "transcript": "가족 중에 암으로 돌아가신 분이 있나요?",
  "language": "ko"
}
```

**특징:**
- **데이터 소스:** AI-Hub 비대면 진료 의료진 및 환자 음성 데이터
- **도메인:** 의료 상담 대화 (의료진-환자 간 질의응답)
- **언어:** 한국어 (ko)
- **용도:** 의료 도메인 특화 음성 인식 모델 학습

### 2. SQA (음성 질의응답) 데이터

**파일:** `SQA.jsonl`, `val_SQA.jsonl`

**형식:**
```json
{
  "instruction": "나의 난청이 왜 생기는지 알고 싶어요.",
  "input": "",
  "audio_path": "초거대/wav/초거대_31814.wav", 
  "output": "난청의 원인에는 전음성 난청 감각신경성 난청 소음성 난청 돌발성 난청 약물성 난청 등이 있습니다. 전음성 난청은 외이 중이 내이의 문제로 인한 청력 저하를 의미합니다..."
}
```

**특징:**
- **데이터 소스:** 초거대 AI 의료 데이터셋 + TTS 변환
- **도메인:** 이비인후과 중심 의료 상담
- **구조:** 음성 질문 + 텍스트 답변 
- **용도:** 멀티모달 의료 질의응답 시스템

### 3. TQA (텍스트 질의응답) 데이터

**파일:** `TQA.jsonl`, `val_TQA.jsonl`

**형식:**
```json
{
  "instruction": "성병이 감염의 원인에 따라 다양한 치료 방법을 사용하는 이유는 무엇입니까?",
  "input": "",
  "output": "성병은 감염의 원인에 따라 다양한 치료 방법을 사용합니다. 세균성 성병의 경우에는 항생제 치료가 필요할 수 있습니다..."
}
```

**특징:**
- **데이터 소스:** 초거대 AI 의료 데이터셋 정제
- **도메인:** 전 의료 분야 (내과, 외과, 이비인후과, 산부인과 등)
- **구조:** 질문(instruction) + 답변(output)
- **용도:** 의료 지식 기반 텍스트 질의응답

## 🛠️ 데이터 생성 도구 (datagen/)

### 1. TTS (Text-to-Speech) 데이터 생성

#### CosyVoice 기반 음성 합성
**위치:** `datagen/TTS/`

**주요 파일:**
- `Asan_tts.py`: 아산병원 의료 데이터를 음성으로 변환
- `CosyVoice/`: 고품질 다국어 TTS 모델
- `초거대_tts.py`: 초거대 AI 텍스트 데이터의 음성 변환

**기능:**
- **Zero-shot TTS**: 프롬프트 음성만으로 화자 모방
- **다화자 지원**: 의료진/환자 음성 구분 생성
- **고품질 합성**: 16kHz, 자연스러운 한국어 음성

**사용 예시:**
```bash
# 아산병원 데이터 TTS 변환
python datagen/TTS/Asan_tts.py

# 초거대 데이터 TTS 변환  
python datagen/TTS/초거대_tts.py
```

### 2. 뉴스 기반 QA 생성

**위치:** `datagen/뉴스/`

**주요 파일:**
- `news_qa_generator.py`: LLM 기반 QA 쌍 자동 생성
- `gen.py`: 뉴스 기사를 활용한 질의응답 데이터 생성

**기능:**
- **자동 QA 생성**: 뉴스 기사 → 질문/답변 쌍 변환
- **비동기 처리**: 대용량 데이터 효율적 처리
- **품질 관리**: 생성된 QA의 품질 검증 및 필터링

**데이터 흐름:**
```
뉴스 기사 본문 → LLM 프롬프트 → Q&A 쌍 생성 → 품질 검증 → JSONL 저장
```

### 3. 비대면 진료 데이터 처리

**위치:** `datagen/비대면 진료/`

**주요 파일:**
- `manifest.ipynb`: 비대면 진료 음성 데이터 매니페스트 생성
- `untitled.py`: 원천 데이터 전처리 스크립트

**기능:**
- **음성-텍스트 매핑**: 의료 상담 오디오와 전사 텍스트 연결
- **메타데이터 생성**: 화자 정보, 진료과, 대화 맥락 정보
- **품질 검증**: 오디오 길이, 전사 품질 검사

### 4. 아산병원 의료 데이터 변환

**위치:** `datagen/아산/`

**주요 파일:**
- `convert_conversational_QA.py`: 의료 정보를 대화형 QA로 변환
- `Asan-AMC-Healthinfo.json`: 아산병원 건강정보 원본

**기능:**
- **구조화**: 의료 백과사전 → instruction-output 형식 변환
- **대화체 변환**: 딱딱한 의료 정보를 자연스러운 대화로 변환
- **도메인 태깅**: 진료과별, 질병별 카테고리 분류

### 5. 초거대 AI 데이터셋 활용

**위치:** `datagen/초거대/`

**주요 파일:**
- `untitled (1).py`: 초거대 AI 의료 데이터셋 전처리
- 의료 QA 데이터 정제 및 형식 통일

## 🔧 데이터 전처리 도구

### med_qa_dedup_normalize.py

**핵심 기능:**
- **중복 제거**: Jaccard similarity, LSH 기반 고속 중복 탐지
- **텍스트 정규화**: 의료 용어 표준화, 형태소 정리
- **품질 필터링**: 너무 짧거나 긴 답변 제거
- **형식 통일**: instruction-input-output 구조로 표준화

**실행 방법:**
```bash
python med_qa_dedup_normalize.py
```

**처리 결과:**
- 중복 제거된 고품질 의료 QA 데이터
- 일관된 형식의 JSONL 파일
- 학습에 최적화된 데이터 구조

## 📈 데이터셋 통계

| 태스크 | 학습 데이터 | 검증 데이터 | 총 데이터 | 평균 길이 |
|--------|------------|------------|-----------|-----------|
| ASR    | 141,820개  | 2,145개    | 143,965개 | 8-12초    |
| SQA    | 16,403개   | 1,823개    | 18,226개  | 5-15초    |
| TQA    | 168,903개  | 18,767개   | 187,670개 | 50-150토큰 |

### 도메인 분포 (의료 분야)
- **이비인후과**: 40% (난청, 중이염, 비염 등)
- **내과**: 25% (감염, 만성질환, 약물 등)
- **외과**: 15% (수술, 외상, 종양 등)
- **산부인과**: 10% (임신, 부인과 질환 등)
- **기타**: 10% (응급의학, 재활의학 등)

## 🚀 데이터 활용 가이드

### 1. 단일 태스크 학습
```bash
# ASR만 학습
python train_asr_only.py --train_data ASR.jsonl --val_data val_ASR.jsonl

# TQA만 학습  
python train_text_only.py --train_data TQA.jsonl --val_data val_TQA.jsonl
```

### 2. 멀티태스크 학습
```bash
# 3개 태스크 동시 학습
python train_multitask.py \
  --train_data ASR.jsonl,SQA.jsonl,TQA.jsonl \
  --val_data val_ASR.jsonl,val_SQA.jsonl,val_TQA.jsonl
```

### 3. 커스텀 데이터 추가
```python
# 새로운 의료 데이터 추가 예시
import json

def add_custom_qa(question, answer, output_file):
    new_data = {
        "instruction": question,
        "input": "",  
        "output": answer
    }
    
    with open(output_file, "a", encoding="utf-8") as f:
        f.write(json.dumps(new_data, ensure_ascii=False) + "\n")
```

## 💡 데이터 품질 관리

### 자동 품질 검증
1. **오디오 품질**: 신호 대 잡음비, 길이, 샘플링 레이트 검사
2. **전사 품질**: 띄어쓰기, 맞춤법, 의료 용어 정확성
3. **QA 품질**: 질문-답변 관련성, 답변 완성도, 의료 정확성

### 수동 검수 가이드라인
- **의료 정확성**: 의료진 검토 필수
- **언어 자연성**: 실제 환자-의료진 대화와 유사성
- **데이터 균형**: 질병별, 진료과별 분포 확인

## 🔒 윤리 및 법적 고려사항

### 개인정보 보호
- 모든 음성 데이터는 개인식별정보 제거
- 합성 음성 사용으로 프라이버시 보호
- 의료 데이터는 일반화된 형태로만 사용

### 의료 정확성 책임
- 생성된 의료 답변은 참고용으로만 사용
- 실제 진료에는 반드시 의료진 상담 필요
- 모든 답변에 "의료진과 상담 권장" 문구 포함

## 📝 라이선스 및 인용

### 데이터 출처
- **AI-Hub**: 비대면 진료 의료진 및 환자 음성 데이터
- **초거대 AI**: 의료 QA 데이터셋 (공개 버전)
- **아산병원**: 건강정보 백과사전 (공개 정보)

### 인용 방법
```bibtex
@dataset{sllm_medical_dataset_2024,
  title={SLLM Medical Multitask Dataset},
  author={SLLM Team},
  year={2024},
  description={Korean medical multitask dataset for ASR, SQA, and TQA},
  language={Korean},
  domain={Medical}
}
```

## 🤝 기여 가이드

새로운 의료 데이터를 추가하거나 품질을 개선하고 싶다면:

1. **데이터 형식**: 기존 JSONL 형식 준수
2. **품질 기준**: 의료 정확성 및 언어 자연성 확보
3. **검증 절차**: 자동 검증 + 의료진 검수
4. **문서화**: 데이터 출처 및 생성 과정 명시

문의사항이나 개선 제안은 프로젝트 관리자에게 연락해주세요.
